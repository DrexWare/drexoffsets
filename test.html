<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>advantage.wtf - CS2 SDK Viewer</title>
  <style>
    :root{--bg:#0f0f11;--sidebar:#141416;--card:#1f1f21;--muted:#9aa0a6;--text:#eef0f2;--accent:#a855f7;--accent-2:#7c3aed;--border:#232327;--glass:rgba(255,255,255,0.03);--glass-2:rgba(255,255,255,0.02);--shadow:0 10px 30px rgba(0,0,0,.6);--trans:.22s cubic-bezier(.2,.9,.2,1)}
    *{box-sizing:border-box;cursor:none}html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Arial;color:var(--text);overflow:hidden}
    body{background:linear-gradient(180deg,#0b0b0d 0%,var(--bg) 100%);display:flex;flex-direction:column;min-height:100vh}
    canvas#bgCanvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1}
    header{height:64px;display:flex;align-items:center;justify-content:space-between;padding:0 20px;font-weight:700;color:var(--accent);background:linear-gradient(90deg,rgba(168,85,247,.03),transparent);backdrop-filter:blur(6px);border-bottom:1px solid var(--border);position:fixed;left:0;right:0;top:0;z-index:60;animation:fadeInDown .6s ease}
    header .title{font-size:18px;letter-spacing:.5px}
    header .actions{display:flex;gap:10px}
    header .actions a{padding:8px 14px;border-radius:10px;background:var(--accent-2);color:#fff;text-decoration:none;font-size:14px;font-weight:600;transition:all .2s}
    header .actions a:hover{background:var(--accent);transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,.4)}
    .wrapper{display:flex;flex:1;padding-top:64px;height:calc(100vh - 64px);gap:20px}
    .sidebar{width:320px;background:linear-gradient(180deg,var(--sidebar),#0f0f10);border-right:1px solid var(--border);padding:14px;border-top-right-radius:12px;border-bottom-right-radius:12px;display:flex;flex-direction:column;transition:width var(--trans);box-shadow:var(--shadow);overflow:hidden;animation:slideInLeft .5s ease}
    .search-area{display:flex;flex-direction:column;gap:10px}
    .search-ui{position:relative;background:var(--glass);border:1px solid var(--border);padding:10px;border-radius:12px;display:flex;align-items:center;gap:10px;cursor:text;min-height:44px;transition:box-shadow var(--trans),transform .25s}
    .search-ui:focus-within{box-shadow:0 6px 24px rgba(124,58,237,.1);border-color:rgba(168,85,247,.65);transform:scale(1.02)}
    .input-display{flex:1;min-height:22px;display:flex;align-items:center;gap:6px;overflow:hidden;white-space:nowrap}
    .input-placeholder{color:var(--muted);user-select:none}
    .chars .char{display:inline-block;padding:0 1px;opacity:0;transform:translateY(12px) scale(.8);animation:typing .25s forwards}
    @keyframes typing{to{opacity:1;transform:none}}
    .clear-btn{background:transparent;border:1px solid transparent;padding:6px;border-radius:8px;color:var(--muted);cursor:pointer;transition:all .15s}
    .clear-btn:hover{color:var(--accent);transform:translateY(-1px)}
    .syntax{font-size:12px;color:var(--muted);background:var(--glass-2);padding:8px;border-radius:8px;border:1px solid var(--border);line-height:1.1;animation:fadeIn .5s ease}
    .syntax code{background:rgba(0,0,0,0.18);padding:3px 6px;border-radius:6px;color:var(--text);font-weight:600;font-size:12px}
    .class-list{margin-top:12px;flex:1;overflow-y:auto;padding-right:6px}
    .class-item{padding:10px 12px;border-radius:10px;margin-bottom:6px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;transition:all var(--trans);border-left:3px solid transparent;animation:fadeInUp .3s ease}
    .class-item:hover{background:linear-gradient(90deg,rgba(255,255,255,0.02),transparent);transform:translateX(6px)}
    .class-item.active{background:linear-gradient(90deg,rgba(124,58,237,.06),transparent);border-left-color:var(--accent);font-weight:700;color:var(--text)}
    .class-item .meta{font-size:12px;color:var(--muted)}
    .content{flex:1;padding:22px;overflow:auto;animation:fadeIn .4s ease}
    .title h1{margin:0;color:var(--accent);font-size:20px}
    .title .parent{color:var(--muted);font-weight:400}
    .card{background:linear-gradient(180deg,var(--card),#0b0b0d);padding:16px;border-radius:12px;border:1px solid var(--border);box-shadow:0 6px 20px rgba(0,0,0,.6);margin-bottom:16px;animation:fadeInUp .4s ease}
    table{width:100%;border-collapse:collapse;margin-top:8px;font-size:13px}
    th,td{padding:8px 10px;border-bottom:1px solid rgba(255,255,255,0.02);text-align:left;vertical-align:top}
    th{color:var(--accent);font-weight:700}
    pre{margin:0;font-family:inherit}
    .footer-note{font-size:12px;color:var(--muted);margin-top:auto;padding-top:12px;text-align:center}
    .watermark{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);font-size:12px;color:var(--muted);opacity:.7;animation:fadeInUp 1s ease}
    #cursor{position:fixed;top:0;left:0;width:18px;height:18px;border:2px solid var(--accent);border-radius:50%;pointer-events:none;transform:translate(-50%,-50%);transition:transform .1s ease-out;z-index:1000}
    .highlight{animation:flash .9s ease;background:rgba(168,85,247,.08);border-left:3px solid rgba(168,85,247,.35)}
    @keyframes flash{0%{background:rgba(168,85,247,.18)}100%{background:rgba(168,85,247,.06)}}
    details{margin-top:8px;border-radius:8px;padding:8px;background:rgba(255,255,255,0.01);border:1px solid rgba(255,255,255,0.02)}
    summary{cursor:pointer;font-weight:700;color:var(--muted);outline:none}
    .small-note{font-size:12px;color:var(--muted);margin-top:8px}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeInUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}@keyframes fadeInDown{from{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:none}}@keyframes slideInLeft{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:none}}
  </style>
</head>
<body>
  <canvas id="bgCanvas"></canvas>
  <div id="cursor"></div>
  <header>
    <div class="title">advantage.<span style="color:#fff">wtf</span> — CS2 SDK Viewer</div>
    <div class="actions"><a href="https://discord.gg/dyq7bNVz5B" target="_blank" style="padding:8px 14px;border-radius:10px;background:var(--accent-2);color:#fff;text-decoration:none;font-size:14px;font-weight:600">Join Discord</a></div>
  </header>

  <div class="wrapper">
    <aside class="sidebar">
      <div class="search-area">
        <div class="search-ui" id="searchUI" tabindex="0">
          <div class="input-display" id="inputDisplay">
            <div class="chars" id="chars"><span class="input-placeholder" id="ph">Search: class:Name or offset:health or plain text</span></div>
          </div>
          <button class="clear-btn" id="clearBtn">✕</button>
        </div>
        <div class="syntax">
          <div><strong style="color:var(--accent)">Search syntax</strong></div>
          <div><code>class:&lt;name&gt;</code> — class names only</div>
          <div><code>offset:&lt;name&gt;</code> — field/offset names only (searches inside modules)</div>
          <div><code>plain text</code> — classes & offsets</div>
        </div>
      </div>

      <div class="class-list" id="classList"></div>
      <div class="footer-note">Select a class to view fields & methods</div>
    </aside>

    <main class="content" id="content">
      <div class="card small">Select a class from the left or start typing. Matches will auto-open and highlight.</div>
    </main>
  </div>

  <div class="watermark">sdk and website made by c l o u d</div>

  <script>
    const JSON_FILES = [
      "dumped/json/client_dll.json",
      "dumped/json/buttons.json",
      "dumped/json/engine2.json",
      "dumped/json/offsets.json"
    ];
    let allClasses = {};
    let lastQuery = "";

    async function fetchData(){
      for(const f of JSON_FILES){
        try{
          const r = await fetch(f);
          if(!r.ok) continue;
          const data = await r.json();
          const k = Object.keys(data)[0];
          const c = data[k];

          if(c && c.classes) Object.entries(c.classes).forEach(([n,cls]) => allClasses[n] = cls);

          // dynamic offsets.json -> CLOUDSDKGLOBALS
          if(f.includes("offsets.json")){
            allClasses["CLOUDSDKGLOBALS"] = { fields: {} };
            // data here likely is an object where keys are modules
            for(const [module, offsets] of Object.entries(data)){
              // store offsets as object for easy iteration and searching
              allClasses["CLOUDSDKGLOBALS"].fields[module] = { type_name: "module", offsets: offsets };
            }
          }
        }catch(e){ /* ignore fetch errors */ }
      }
      renderClassList("");
    }

    function parseSearch(s){
      s = (s||"").trim().toLowerCase();
      if(!s) return ["all",""];
      if(s.startsWith("class:")) return ["class", s.slice(6).trim()];
      if(s.startsWith("offset:")) return ["offset", s.slice(7).trim()];
      return ["all", s];
    }

    function renderClassList(filter){
      lastQuery = filter || "";
      const list = document.getElementById("classList"); list.innerHTML = "";
      const [mode, q] = parseSearch(filter);
      const names = Object.keys(allClasses).sort((a,b)=>a.localeCompare(b));
      let firstMatch = null;

      for(const name of names){
        const cls = allClasses[name];
        let show = false;
        const lname = name.toLowerCase();

        if(mode === "class"){
          if(!q || lname.includes(q)) show = true;
        } else if(mode === "offset"){
          // check inside fields and, for modules, inside offsets
          if(cls.fields){
            for(const [f,info] of Object.entries(cls.fields)){
              if(info && info.offsets){
                for(const offName of Object.keys(info.offsets)){
                  if(offName.toLowerCase().includes(q)){ show = true; break; }
                }
                if(show) break;
              } else {
                if(f.toLowerCase().includes(q)){ show = true; break; }
              }
            }
          }
        } else {
          if(lname.includes(q)) show = true;
          if(!show && cls.fields){
            for(const [f,info] of Object.entries(cls.fields)){
              if(f.toLowerCase().includes(q)){ show = true; break; }
              if(info && info.offsets){
                for(const offName of Object.keys(info.offsets)){
                  if(offName.toLowerCase().includes(q)){ show = true; break; }
                }
                if(show) break;
              }
            }
          }
        }
        if(!show) continue;

        const el = document.createElement("div");
        el.className = "class-item";
        el.innerHTML = `<div>${name}</div><div class="meta">${cls.parent?cls.parent:""}</div>`;
        el.onclick = () => selectClass(name, el, q);
        list.appendChild(el);

        if(!firstMatch) firstMatch = {name, el};
      }

      // auto-select/scroll to closest match if query present
      if(q && firstMatch){
        // small delay so DOM paints then select
        setTimeout(()=>{
          try{ firstMatch.el.click(); firstMatch.el.scrollIntoView({block:"center",behavior:"smooth"}); }catch(e){}
        },80);
      }
    }

    function formatHex(val){
      if(typeof val === "number" && Number.isFinite(val)){
        return "0x" + val.toString(16).padStart(1,"0").toUpperCase();
      }
      if(typeof val === "string" && /^-?\d+$/.test(val)){
        const n = parseInt(val,10);
        return "0x" + n.toString(16).toUpperCase();
      }
      return String(val);
    }

    function selectClass(name, el, q){
      document.querySelectorAll(".class-item").forEach(x=>x.classList.remove("active"));
      if(el) el.classList.add("active");
      const content = document.getElementById("content"); content.innerHTML = "";
      const cls = allClasses[name] || {};
      const title = document.createElement("div"); title.className = "title";
      title.innerHTML = `<h1>${name}${cls.parent? ' <span class="parent">: ' + cls.parent + '</span>': ''}</h1>`;
      content.appendChild(title);

      // Fields area
      if(cls.fields){
        const fCard = document.createElement("div"); fCard.className = "card";
        fCard.innerHTML = `<strong style='color:var(--accent)'>Fields — ${name}</strong>`;
        // For normal classes: render a table of fields
        // For CLOUDSDKGLOBALS modules: render each module as a details block with its own table
        // Detect if many modules (module objects with offsets)
        let hasModules = false;
        for(const info of Object.values(cls.fields)){
          if(info && info.offsets) { hasModules = true; break; }
        }

        if(hasModules){
          // Render each module as <details>
          for(const [module, info] of Object.entries(cls.fields)){
            const det = document.createElement("details");
            const sum = document.createElement("summary");
            sum.textContent = module;
            det.appendChild(sum);

            const moduleNote = document.createElement("div"); moduleNote.className = "small-note"; moduleNote.textContent = info.type_name ? info.type_name : "";
            det.appendChild(moduleNote);

            const t = document.createElement("table");
            t.innerHTML = `<thead><tr><th>Name</th><th>Decimal</th><th>Hex</th></tr></thead>`;
            const tb = document.createElement("tbody");

            const offs = info.offsets || {};
            let idx = 0;
            for(const [field, value] of Object.entries(offs)){
              const tr = document.createElement("tr");
              tr.id = `field-${module}-${idx++}`;
              const dec = (typeof value === "number" || (/^-?\d+$/.test(String(value)))) ? String(value) : String(value);
              const hex = formatHex(value);
              tr.innerHTML = `<td style="font-weight:600">${field}</td><td><pre style="white-space:pre-wrap;font-size:11px;margin:0">${dec}</pre></td><td><pre style="white-space:pre-wrap;font-size:11px;margin:0">${hex}</pre></td>`;
              tb.appendChild(tr);
            }
            t.appendChild(tb);
            det.appendChild(t);
            fCard.appendChild(det);
          }
        } else {
          // no modules — render standard fields table
          const t = document.createElement("table");
          t.innerHTML = "<thead><tr><th>Name</th><th>Type</th><th>Offset</th><th>Hex</th></tr></thead>";
          const tb = document.createElement("tbody");
          for(const [field, info] of Object.entries(cls.fields)){
            let offset = '?', type = 'unknown';
            if(typeof info === "object"){
              offset = info.offset ?? '?';
              type = info.type_name ?? 'unknown';
            } else offset = info;
            const hex = formatHex(offset);
            const tr = document.createElement("tr");
            tr.innerHTML = `<td style="font-weight:600">${field}</td><td>${type}</td><td><pre style="white-space:pre-wrap;font-size:11px;margin:0">${String(offset)}</pre></td><td><pre style="white-space:pre-wrap;font-size:11px;margin:0">${hex}</pre></td>`;
            tb.appendChild(tr);
          }
          t.appendChild(tb);
          fCard.appendChild(t);
        }

        content.appendChild(fCard);

        // If there is a search query, try to highlight & scroll to the matching offset
        const sq = (q || "").trim().toLowerCase();
        if(sq){
          // first try to find an exact class name match; otherwise find offset inside modules or fields
          if(name.toLowerCase().includes(sq)){
            // highlight title
            title.classList.add("highlight");
            setTimeout(()=>title.classList.remove("highlight"),1200);
          } else {
            // search inside module offsets
            let found = false;
            for(const [module, info] of Object.entries(cls.fields)){
              if(info && info.offsets){
                // try to find the best matching field name
                const keys = Object.keys(info.offsets);
                for(let i=0;i<keys.length;i++){
                  const fieldName = keys[i];
                  if(fieldName.toLowerCase().includes(sq)){
                    // open the module's <details> and scroll to row
                    const detailsElems = Array.from(content.querySelectorAll("details"));
                    for(const d of detailsElems){
                      if(d.querySelector("summary") && d.querySelector("summary").textContent === module){
                        d.open = true;
                        // find the corresponding TR inside this details
                        const tr = d.querySelectorAll("tbody tr")[i];
                        if(tr){
                          tr.classList.add("highlight");
                          tr.scrollIntoView({behavior:"smooth", block:"center"});
                          setTimeout(()=>tr.classList.remove("highlight"),1800);
                          found = true;
                          break;
                        }
                      }
                    }
                    if(found) break;
                  }
                }
                if(found) break;
              } else {
                // fields that are not modules (rare)
                if(module.toLowerCase().includes(sq)){
                  // highlight the summary if present
                  const detailsElems = Array.from(content.querySelectorAll("details"));
                  for(const d of detailsElems){
                    if(d.querySelector("summary") && d.querySelector("summary").textContent === module){
                      d.open = true;
                      d.classList.add("highlight");
                      setTimeout(()=>d.classList.remove("highlight"),1200);
                      found = true; break;
                    }
                  }
                }
              }
            }
            // fallback: highlight class card
            if(!found){
              const fCardEl = content.querySelector(".card");
              if(fCardEl){ fCardEl.classList.add("highlight"); setTimeout(()=>fCardEl.classList.remove("highlight"),1200); }
            }
          }
        }
      }

      // Methods area (unchanged)
      if(cls.methods){
        const mBox = document.createElement("div"); mBox.className = "card";
        mBox.innerHTML = "<strong style='color:var(--accent)'>Methods</strong>";
        const t = document.createElement("table");
        t.innerHTML = "<thead><tr><th>Name</th><th>Return</th><th>Args</th></tr></thead>";
        const tb = document.createElement("tbody");
        for(const [m, info] of Object.entries(cls.methods)){
          const ret = info.return_type || "void";
          const args = (info.args || []).map(a=>`${a.type_name||"?"} ${a.name||""}`).join(", ");
          const tr = document.createElement("tr");
          tr.innerHTML = `<td>${m}</td><td>${ret}</td><td>${args}</td>`;
          tb.appendChild(tr);
        }
        t.appendChild(tb); mBox.appendChild(t); content.appendChild(mBox);
      }
    }

    // search input handling (minimal changes from your original)
    let query = "";
    const searchUI = document.getElementById("searchUI");
    const charsWrap = document.getElementById("chars");
    const ph = document.getElementById("ph");
    const clearBtn = document.getElementById("clearBtn");
    let focused = false;
    searchUI.addEventListener("click", ()=>{ focused = true; ph.style.display = "none"; });
    document.addEventListener("click", e => { if(!searchUI.contains(e.target)){ focused = false; if(!query) ph.style.display = "block"; }});
    document.addEventListener("keydown", e=>{
      if(!focused) return;
      const k = e.key;
      if(k.length===1 && !e.ctrlKey && !e.metaKey){
        query += k; appendChar(k); renderClassList(query); e.preventDefault();
      } else if(k === "Backspace"){
        if(query.length){ query = query.slice(0,-1); removeChar(); renderClassList(query); }
        e.preventDefault();
      } else if(k === "Enter"){
        // if any class items exist, click active or first one
        const active = document.querySelector(".class-item.active") || document.querySelector(".class-item");
        if(active) active.click();
        e.preventDefault();
      } else if(k === "Escape"){
        query = ""; clearAll(); renderClassList(query); e.preventDefault();
      }
    });
    function appendChar(ch){ ph.style.display = "none"; const s = document.createElement("span"); s.className = "char"; s.textContent = ch; charsWrap.appendChild(s); }
    function removeChar(){ const last = charsWrap.querySelector(".char:last-child"); if(last) last.remove(); if(!charsWrap.querySelector(".char")) ph.style.display = "block"; }
    function clearAll(){ query=""; charsWrap.innerHTML=""; ph.style.display="block"; }
    clearBtn.addEventListener("click", ()=>{ clearAll(); renderClassList(query); });

    // cursor & background (kept small)
    const cursor = document.getElementById("cursor");
    document.addEventListener("mousemove", e => { cursor.style.transform = `translate(${e.clientX}px, ${e.clientY}px)` });
    const canvas = document.getElementById("bgCanvas"), ctx = canvas.getContext("2d");
    function resize(){ canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.addEventListener("resize", resize); resize();
    const dots = Array.from({length:40}, ()=>({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:1+Math.random()*2,s:.2+Math.random()*.6}));
    function draw(){ ctx.clearRect(0,0,canvas.width,canvas.height); for(const d of dots){ ctx.beginPath(); ctx.arc(d.x,d.y,d.r,0,Math.PI*2); ctx.fillStyle="rgba(124,58,237,.15)"; ctx.fill(); d.y+=d.s; if(d.y>canvas.height) d.y=-5 } requestAnimationFrame(draw); }
    draw();

    fetchData();
  </script>
</body>
</html>
